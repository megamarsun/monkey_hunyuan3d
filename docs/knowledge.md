# 設計判断・履歴

## 入力モード設計

### 2025-09-26 入力モード切替設計

- **背景:** 初期実装では Hunyuan3D API 入力として画像（ImageBase64）のみが有効であり、プロンプト入力欄は UI に存在するものの送信処理では無視されていた。
- **問題点:** プロンプト入力が死んでおり、ユーザーが想定した動作と異なる挙動をしていた。
- **判断:** UIおよびオペレーターに「入力モード（PROMPT / IMAGE）」を新設し、相互排他で入力を切り替える設計へ変更する。
- **方針:**
  1. デフォルトは従来互換の「IMAGE」
  2. PROMPT選択時はプロンプト送信のみ、IMAGE選択時はBase64送信のみ
  3. 双方入力された場合はモード優先で送信、INFOで警告出力
- **将来展望:**
  - APIが対応次第「BOTH」モードを追加し、プロンプト＋画像の同時入力を可能にする。
  - LoRAや追加パラメータ対応時も `input_mode` 拡張により破壊的変更なく対応可能。
- **開発メモ:** SDKのパラメータ名は環境により異なる可能性があるため、`prefs` に「Prompt parameter name」を追加し、差し替え可能な設計にしている。

### 2025-09-26 プロンプトのスクリプトファイル対応

- **背景:** Blenderのインライン入力が狭く、長文プロンプトの編集性が低い課題があった。
- **判断:** PROMPTモードに「入力元（INLINE / TEXT_BLOCK / EXTERNAL_FILE）」を導入。テキストエディタ起動・新規作成・保存／読み込みの操作をUIから可能にする。
- **互換:** 既定はINLINE。既存ワークフローは維持。
- **実装メモ:** 実行直前に選択ソースから文字列を取得してAPIへ送信。外部ファイルはUTF-8想定、改行は内部でLF正規化。
